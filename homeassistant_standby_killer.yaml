blueprint:
  name: ðŸ’¡ Standby-Killer fÃ¼r Steckdosen (mit Steuerung & Schutz)
  description: >
    Version: 1.0  
    Erstellt: Mai 2025  
    Autor: Martin  

    ðŸ’¡ Automatisches Abschalten einer Steckdose, wenn der Stromverbrauch lÃ¤ngere Zeit unter einem frei definierbaren Schwellenwert liegt.

    âœ… Ideal fÃ¼r TV, Hi-Fi, Drucker usw.  
    âœ… Wartezeit zwischen 1 Minute und 24 Stunden frei einstellbar  
    âœ… SchÃ¼tzt vor Sensorfehlern (z.â€¯B. "unavailable")  
    âœ… Kann mit zwei Helfern aktiviert/deaktiviert oder auf Dauerbetrieb gestellt werden

    ---
    âš™ï¸ Verwendet:
    - `input_boolean.standby_killer_aktiv`
    - `input_boolean.dauerbetrieb_aktiv`
    - Sensor mit Verbrauch in Watt
    - Schaltbare Steckdose
    ---

    Ã„nderungen:
    - v1.0: Erste Version mit vollstÃ¤ndiger Steuerlogik und Dauerfeld

  domain: automation
  input:
    power_sensor:
      name: ðŸ”Œ Verbrauchssensor
      description: WÃ¤hle den Sensor aus, der den Stromverbrauch misst (z.â€¯B. sensor.tv_power).
      selector:
        entity:
          domain: sensor

    plug_switch:
      name: ðŸ§  Steckdose
      description: WÃ¤hle die Steckdose, die automatisch ausgeschaltet werden soll.
      selector:
        entity:
          domain: switch

    watt_threshold:
      name: âš¡ Verbrauchs-Schwelle in Watt
      description: Wenn der Verbrauch unter diesem Wert bleibt, wird nach Ablauf der Wartezeit abgeschaltet.
      default: 5
      selector:
        number:
          min: 0
          max: 50
          unit_of_measurement: W
          step: 0.1
          mode: slider

    wait_time:
      name: â³ Wartezeit (bis zur Abschaltung)
      description: So lange muss der Verbrauch unter der Schwelle bleiben, bevor abgeschaltet wird.
      default: "02:00:00"
      selector:
        duration:

    aktiv_schalter:
      name: âœ… Standby-Killer EIN/AUS (Helfer)
      description: Umschalter, um die Automation generell zu aktivieren oder zu deaktivieren.
      selector:
        entity:
          domain: input_boolean

    dauerbetrieb_schalter:
      name: âŒ Dauerbetrieb aktiv (Helfer)
      description: Wenn dieser Umschalter aktiv ist, wird **nie** abgeschaltet â€“ unabhÃ¤ngig vom Verbrauch.
      selector:
        entity:
          domain: input_boolean

trigger:
  - platform: numeric_state
    entity_id: !input power_sensor
    below: !input watt_threshold
    for: !input wait_time

condition:
  - condition: template
    value_template: >
      {{ states(!input.power_sensor) not in ['unavailable', 'unknown'] }}
  - condition: state
    entity_id: !input plug_switch
    state: "on"
  - condition: state
    entity_id: !input aktiv_schalter
    state: "on"
  - condition: state
    entity_id: !input dauerbetrieb_schalter
    state: "off"

action:
  - service: switch.turn_off
    target:
      entity_id: !input plug_switch

mode: single
