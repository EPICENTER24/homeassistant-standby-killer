blueprint:
  name: ðŸ’¡ Standby-Killer fÃ¼r Steckdosen (optional abschaltbar)
  description: >
    Version: 1.2.0  
    Erstellt: Mai 2025  
    Autor: Martin  

    ðŸ’¡ Automatisches Abschalten einer Steckdose bei dauerhaft niedrigem Stromverbrauch.

    âœ… Ideal fÃ¼r TV, Hi-Fi, Drucker  
    âœ… Schwellwert in ganzen Watt (max. 100 W)  
    âœ… Einstellbare Wartezeit (1 Min. â€“ 24 Std.)  
    âœ… Optional deaktivierbar (Standby-Killer AUS)  

    Ã„nderungen:
    - v1.2.0: Fehlerfreie YAML- & Jinja-Logik implementiert

  domain: automation
  input:
    power_sensor:
      name: ðŸ”Œ Verbrauchssensor
      selector:
        entity:
          domain: sensor

    plug_switch:
      name: ðŸ§  Steckdose
      selector:
        entity:
          domain: switch

    watt_threshold:
      name: âš¡ Verbrauchsschwelle (Watt)
      default: 5
      selector:
        number:
          min: 0
          max: 100
          step: 1
          unit_of_measurement: W
          mode: slider

    wait_time:
      name: â³ Wartezeit
      default: "02:00:00"
      selector:
        duration:

    abschalt_sperre:
      name: ðŸš« Standby-Killer AUS (optional)
      description: >
        Optionaler Schalter: Wenn auf AN, keine automatische Abschaltung.
      default: ""
      selector:
        entity:
          domain: input_boolean
          multiple: false

trigger:
  - platform: numeric_state
    entity_id: !input power_sensor
    below: !input watt_threshold
    for: !input wait_time

condition:
  - condition: state
    entity_id: !input plug_switch
    state: "on"

action:
  - choose:
      - conditions:
          - condition: template
            value_template: >
              {{ inputs.get('abschalt_sperre') in [none, ''] or is_state(inputs.get('abschalt_sperre'), 'off') }}
        sequence:
          - service: switch.turn_off
            target:
              entity_id: !input plug_switch
mode: single
